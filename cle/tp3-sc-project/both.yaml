statechart: 
  name: BothACUnit
  preamble: |
    currTempLR = 20
    currTempB = 20
  root state: 
    name: BAC
    initial: AC_UNITS 


    states: 
      - name: AC_UNITS  
        parallel states:

          - name: LIVING_ROOM
            initial: OFF_LR
            states: 
              - name: OFF_LR
                transitions: 
                  - target: ON_LR 
                    event: on_off_1
                    action: |
                      r1.ac_on(0)
                      desTempLR = currTempLR

              - name: ON_LR 
                initial: Manuel_LR 
                transitions: 
                  - target: OFF_LR 
                    event: on_off_1
                    action: |
                      r1.ac_off()
                  - target: Automatique_LR 
                    event: plus_1
                    action: |
                      desTempLR += 1
                      r1.ac_on(0)
                  - target: Automatique_LR 
                    event: minus_1
                    action: |
                      desTempLR -= 1
                      r1.ac_on(0)

                states: 
                  - name: Manuel_LR 
                    initial: Pause_M_LR


                    states: 
                      - name: LastUsedStateManual_LR
                        type: shallow history 

                      - name: Pause_M_LR
                        transitions: 
                          - target: Cooling_M_LR
                            event: next_1
                            action: r1.ac_on(-1) 

                      - name: Cooling_M_LR 
                        transitions: 
                          - target: Heating_M_LR 
                            event: next_1
                            action: r1.ac_on(1)

                      - name: Heating_M_LR
                        transitions: 
                          - target: Pause_M_LR
                            event: next_1
                            action: r1.ac_on(0)

                  - name: Automatique_LR
                    initial: Pause_A_LR
                    transitions: 
                      - target: LastUsedStateManual_LR
                        event: next_1
                      - event: plus_1
                        target: Automatique_LR
                        action: |
                          desTempLR += 1
                          r1.ac_on(0)
                      - event: minus_1
                        target: Automatique_LR
                        action: |
                          desTempLR -= 1
                          r1.ac_on(0)

                    
                    states: 
                      - name: Pause_A_LR
                        transitions: 
                          - target: Cooling_A_LR
                            event: tick 
                            guard: currTempLR > desTempLR + 1 
                            action: |
                              r1.ac_on(-1)

                          - target: Heating_A_LR 
                            event: tick   
                            guard: currTempLR < desTempLR-1  
                            action: |
                              r1.ac_on(1)

                          - target: Pause_A_LR
                            event: tick
                            guard: currTempLR==desTempLR
                            action: |
                              r1.ac_on(0)
                            
                      - name: Cooling_A_LR
                        transitions: 
                          - target: Pause_A_LR
                            guard: abs(currTempLR - desTempLR) < 0.1
                            event: tick
                            action: |
                              r1.ac_on(0)

                          - target: Heating_A_LR 
                            guard: currTempLR < desTempLR-1 
                            event: tick
                            action: |
                              r1.ac_on(1)

                          - target: Cooling_A_LR 
                            event: tick
                            action: |
                              currTempLR -= 1
                            guard: currTempLR>desTempLR

                      - name: Heating_A_LR 
                        transitions: 
                          - target: Pause_A_LR
                            event: tick
                            guard: abs(currTempLR - desTempLR) < 0.1
                            action: | 
                              r1.ac_on(0)

                          - target: Cooling_A_LR 
                            guard: currTempLR > desTempLR +1
                            event: tick
                            action: |
                              r1.ac_on(-1)

                          - target: Heating_A_LR
                            event: tick 
                            action: |
                              currTempLR += 1
                            guard: currTempLR < desTempLR 
                

          - name: BEDROOM
            initial: OFF_B
            states: 
              - name: OFF_B 
                transitions: 
                  - target: ON_B 
                    event: on_off_2
                    action: |
                      r2.ac_on(0)
                      desTempB = currTempB

              - name: ON_B 
                initial: Manuel_B 
                transitions: 
                  - target: OFF_B 
                    event: on_off_2
                    action: |
                      r2.ac_off()
                  - target: Automatique_B 
                    event: plus_2
                    action: |
                      desTempB += 1
                      r2.ac_on(0)
                  - target: Automatique_B 
                    event: minus_2
                    action: |
                      desTempB -= 1
                      r2.ac_on(0)

                states: 
                  - name: Manuel_B 
                    initial: Pause_M_B


                    states: 
                      - name: LastUsedStateManual_B
                        type: shallow history 

                      - name: Pause_M_B
                        transitions: 
                          - target: Cooling_M_B
                            event: next_2
                            action: r2.ac_on(-1) 

                      - name: Cooling_M_B 
                        transitions: 
                          - target: Heating_M_B 
                            event: next_2
                            action: r2.ac_on(1)

                      - name: Heating_M_B
                        transitions: 
                          - target: Pause_M_B
                            event: next_2
                            action: r2.ac_on(0)

                  - name: Automatique_B
                    initial: Pause_A_B
                    transitions: 
                      - target: LastUsedStateManual_B
                        event: next_2
                      - event: plus_2
                        target: Automatique_B
                        action: |
                          desTempB += 1
                          r2.ac_on(0)
                      - event: minus_2
                        target: Automatique_B
                        action: |
                          desTempB -= 1
                          r2.ac_on(0)

                    
                    states: 
                      - name: Pause_A_B 
                        transitions: 
                          - target: Cooling_A_B
                            event: tick 
                            guard: currTempB > desTempB + 1 
                            action: |
                              r2.ac_on(-1)

                          - target: Heating_A_B 
                            event: tick   
                            guard: currTempB < desTempB-1  
                            action: |
                              r2.ac_on(1)

                          - target: Pause_A_B
                            event: tick
                            guard: currTempB==desTempB
                            action: |
                              r2.ac_on(0)
                            
                      - name: Cooling_A_B
                        transitions: 
                          - target: Pause_A_B 
                            guard: abs(currTempB - desTempB) < 0.1
                            event: tick
                            action: |
                              r2.ac_on(0)

                          - target: Heating_A_B 
                            guard: currTempB < desTempB-1 
                            event: tick
                            action: |
                              r2.ac_on(1)

                          - target: Cooling_A_B 
                            event: tick
                            action: |
                              currTempB -= 1
                            guard: currTempB>desTempB

                      - name: Heating_A_B 
                        transitions: 
                          - target: Pause_A_B
                            event: tick
                            guard: abs(currTempB - desTempB) < 0.1
                            action: | 
                              r2.ac_on(0)

                          - target: Cooling_A_B 
                            guard: currTempB > desTempB +1
                            event: tick
                            action: |
                              r2.ac_on(-1)

                          - target: Heating_A_B
                            event: tick 
                            action: |
                              currTempB += 1
                            guard: currTempB < desTempB

